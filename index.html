<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Data Chart</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <style>
        iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
        #chart-container {
            display: none; /* Ẩn nội dung iframe cho đến khi được hiển thị */
        }
    </style>
</head>
<body>
    <h1>Weather Data Visualization</h1>

    <!-- Container cho biểu đồ (iframe sẽ hiển thị nội dung này) -->
    <div id="chart-container">
        <div id="chart" style="width: 100%; height: 500px;"></div>
    </div>

    <!-- iFrame để hiển thị nội dung -->
    <iframe id="chart-iframe"></iframe>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // URL đến file CSV
            const csvUrl = 'https://raw.githubusercontent.com/phuonguyen1803/live-data-chart/main/hourly_weather_data.csv';

            // Hàm khởi tạo biểu đồ
            function createChart(data) {
                const container = document.getElementById('chart');
                Highcharts.chart(container, {
                    chart: {
                        type: 'line'
                    },
                    title: {
                        text: 'Temperature and Humidity Over Time'
                    },
                    xAxis: {
                        type: 'datetime',
                        title: {
                            text: 'Time'
                        }
                    },
                    yAxis: [{
                        title: {
                            text: 'Temperature (°C)'
                        }
                    }, {
                        title: {
                            text: 'Humidity (%)'
                        },
                        opposite: true
                    }],
                    series: [{
                        name: 'Temperature (°C)',
                        data: data.temperature,
                        yAxis: 0
                    }, {
                        name: 'Humidity (%)',
                        data: data.humidity,
                        yAxis: 1
                    }]
                });
            }

            // Đọc file CSV
            Papa.parse(csvUrl, {
                download: true,
                header: true,
                complete: function (results) {
                    const jsonData = results.data;
                    const temperatureData = [];
                    const humidityData = [];

                    jsonData.forEach(record => {
                        if (record.Date && record.Time && record['Temperature (°C)'] && record['Humidity (%)']) {
                            const time = new Date(record.Date + ' ' + record.Time).getTime();
                            const temperature = parseFloat(record['Temperature (°C)']);
                            const humidity = parseFloat(record['Humidity (%)']);

                            temperatureData.push([time, temperature]);
                            humidityData.push([time, humidity]);
                        }
                    });

                    // Tạo biểu đồ với dữ liệu đã xử lý
                    const chartData = {
                        temperature: temperatureData,
                        humidity: humidityData
                    };

                    createChart(chartData);

                    // Hiển thị nội dung trong iframe
                    const iframe = document.getElementById('chart-iframe');
                    const chartContainer = document.getElementById('chart-container');

                    // Hiển thị nội dung của container trong iframe
                    const iframeDoc = iframe.contentWindow.document;
                    iframeDoc.open();
                    iframeDoc.write(chartContainer.innerHTML);
                    iframeDoc.close();
                },
                error: function (error) {
                    console.error('Error loading CSV:', error);
                }
            });
        });
    </script>
</body>
</html>
